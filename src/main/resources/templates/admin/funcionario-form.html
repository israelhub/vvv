<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{admin/layout}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Cadastro de Funcionário</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div layout:fragment="content">
      <div class="container mt-5">
        <h2 th:text="${editando ? 'Editar' : 'Cadastro de'} + ' Funcionário'">
          Cadastro de Funcionário
        </h2>

        <input
          type="hidden"
          name="id_funcionario"
          th:if="${funcionario != null}"
          th:value="${funcionario.id_funcionario}"
        />

        <form
          th:action="${editando ? '/web/administracao/funcionario/editar/' + funcionario.id_funcionario : '/web/administracao/funcionario'}"
          method="post"
        >
          <div class="mb-3">
            <label for="nome" class="form-label">Nome</label>
            <input
              type="text"
              th:value="${funcionario != null ? funcionario.nome : ''}"
              class="form-control"
              id="nome"
              name="nome"
              required
            />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              th:value="${funcionario != null ? funcionario.email : ''}"
              required
            />
          </div>
          <div class="mb-3">
            <label for="cargo" class="form-label">Cargo</label>
            <select class="form-control" id="cargo" name="cargo" required>
              <option
                value="GERENTE"
                th:selected="${funcionario != null && funcionario.cargo == 'GERENTE'}"
              >
                Gerente
              </option>
              <option
                value="GERENTE_DE_NEGOCIOS_VIRTUAIS"
                th:selected="${funcionario != null && funcionario.cargo == 'GERENTE_DE_NEGOCIOS_VIRTUAIS'}"
              >
                Gerente de Negócios Virtuais
              </option>
              <option
                value="PADRAO"
                th:selected="${funcionario != null && funcionario.cargo == 'PADRAO'}"
              >
                Padrão
              </option>
            </select>
          </div>

          <div class="pontosDeVendaContainer">
            <!-- Se não houver pontos, mostra formulário vazio -->
            <div
              th:if="${pontosFuncionario == null or pontosFuncionario.empty}"
              class="pontoDeVenda"
            >
              <div class="mb-3">
                <label class="form-label">Ponto de Venda</label>
                <select name="pontoDeVenda" class="form-control">
                  <option value="">Selecione um ponto de venda</option>
                  <option
                    th:each="pdv : ${pontosDeVenda}"
                    th:value="${pdv.id_ponto_de_venda}"
                    th:text="${pdv.nome}"
                  ></option>
                </select>
              </div>

              <div class="diasContainer">
                <div class="dia mb-3">
                  <div class="row">
                    <div class="col">
                      <label>Dia da Semana</label>
                      <select name="diaSemana" class="form-control">
                        <option value="">Selecione um dia</option>
                        <option value="SEGUNDA">Segunda</option>
                        <option value="TERCA">Terça</option>
                        <option value="QUARTA">Quarta</option>
                        <option value="QUINTA">Quinta</option>
                        <option value="SEXTA">Sexta</option>
                        <option value="SABADO">Sábado</option>
                        <option value="DOMINGO">Domingo</option>
                      </select>
                    </div>
                    <div class="col">
                      <label>Horário Inicial</label>
                      <input
                        type="time"
                        name="horarioInicial"
                        class="form-control"
                      />
                    </div>
                    <div class="col">
                      <label>Horário Final</label>
                      <input
                        type="time"
                        name="horarioFinal"
                        class="form-control"
                      />
                    </div>
                    <div class="col-auto align-self-end mb-3">
                      <button type="button" class="btn btn-danger removeDia">
                        Remover
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-secondary addDia">
                Adicionar Dia
              </button>
            </div>

            <!-- Se houver pontos, itera sobre eles -->
            <div th:each="ponto : ${pontosFuncionario}" class="pontoDeVenda">
              <div class="mb-3">
                <label class="form-label">Ponto de Venda</label>
                <select name="pontoDeVenda" class="form-control">
                  <option value="">Selecione um ponto de venda</option>
                  <option
                    th:each="pdv : ${pontosDeVenda}"
                    th:value="${pdv.id_ponto_de_venda}"
                    th:text="${pdv.nome}"
                    th:selected="${ponto.pontoDeVenda != null && ponto.pontoDeVenda.id_ponto_de_venda == pdv.id_ponto_de_venda}"
                  ></option>
                </select>
              </div>

              <div class="diasContainer">
                <div class="dia mb-3">
                  <div class="row">
                    <div class="col">
                      <label>Dia da Semana</label>
                      <select name="diaSemana" class="form-control">
                        <option value="">Selecione um dia</option>
                        <option
                          value="SEGUNDA"
                          th:selected="${ponto.id.diaSemana == 'SEGUNDA'}"
                        >
                          Segunda
                        </option>
                        <option
                          value="TERCA"
                          th:selected="${ponto.id.diaSemana == 'TERCA'}"
                        >
                          Terça
                        </option>
                        <option
                          value="QUARTA"
                          th:selected="${ponto.id.diaSemana == 'QUARTA'}"
                        >
                          Quarta
                        </option>
                        <option
                          value="QUINTA"
                          th:selected="${ponto.id.diaSemana == 'QUINTA'}"
                        >
                          Quinta
                        </option>
                        <option
                          value="SEXTA"
                          th:selected="${ponto.id.diaSemana == 'SEXTA'}"
                        >
                          Sexta
                        </option>
                        <option
                          value="SABADO"
                          th:selected="${ponto.id.diaSemana == 'SABADO'}"
                        >
                          Sábado
                        </option>
                        <option
                          value="DOMINGO"
                          th:selected="${ponto.id.diaSemana == 'DOMINGO'}"
                        >
                          Domingo
                        </option>
                      </select>
                    </div>
                    <div class="col">
                      <label>Horário Inicial</label>
                      <input
                        type="time"
                        name="horarioInicial"
                        class="form-control"
                        th:value="${ponto.horarioInicial}"
                      />
                    </div>
                    <div class="col">
                      <label>Horário Final</label>
                      <input
                        type="time"
                        name="horarioFinal"
                        class="form-control"
                        th:value="${ponto.horarioFinal}"
                      />
                    </div>
                    <div class="col-auto align-self-end mb-3">
                      <button type="button" class="btn btn-danger removeDia">
                        Remover
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-secondary addDia">
                Adicionar Dia
              </button>
            </div>
          </div>

          <button type="button" class="btn btn-secondary mt-3 addPontoDeVenda">
            Adicionar Ponto de Venda
          </button>
          <button type="button" class="btn btn-danger mt-3 removePontoDeVenda">
            Remover Ponto de Venda
          </button>
          <button type="submit" class="btn btn-primary mt-3">
            <span th:text="${editando ? 'Salvar Alterações' : 'Cadastrar'}"
              >Cadastrar</span
            >
          </button>
        </form>

        <div th:if="${mensagem}" th:class="${'alert alert-' + tipoMensagem}">
          <p th:text="${mensagem}"></p>
        </div>
      </div>

      <script>
        $(document).ready(function () {
          // Adicionar ponto de venda
          $(".addPontoDeVenda").click(function () {
            var pontoHtml = $(".pontoDeVenda").first().clone();
            pontoHtml.find("input").val("");
            pontoHtml.find("select").prop("selectedIndex", 0);
            pontoHtml.find(".diasContainer .dia:not(:first)").remove(); // Remove dias extras
            $(".pontosDeVendaContainer").append(pontoHtml);
          });

          // Remover ponto de venda
          $(".removePontoDeVenda").click(function () {
            if ($(".pontoDeVenda").length > 1) {
              $(".pontoDeVenda:last").remove();
            }
          });

          // Adicionar dia
          $(document).on("click", ".addDia", function () {
            var diaHtml = $(this)
              .siblings(".diasContainer")
              .find(".dia")
              .first()
              .clone();
            diaHtml.find("input").val("");
            diaHtml.find("select").prop("selectedIndex", 0);
            $(this).siblings(".diasContainer").append(diaHtml);
          });

          // Remover dia
          $(document).on("click", ".removeDia", function () {
            var diasContainer = $(this).closest(".diasContainer");
            if (diasContainer.find(".dia").length > 1) {
              $(this).closest(".dia").remove();
            }
          });
        });
      </script>
    </div>
  </body>
</html>
